
<script src="/static/sigma/sigma.min.js"></script>
<script src="/static/sigma/plugins/sigma.exporters.svg.min.js"></script>
<script src="/static/sigma/plugins/sigma.layout.forceAtlas2.min.js"></script>
<script src="/static/sigma/plugins/sigma.neo4j.cypher.min.js"></script>
<script src="/static/sigma/plugins/sigma.parsers.cypher.min.js"></script>
<script src="/static/sigma/plugins/sigma.parsers.gexf.min.js"></script>
<script src="/static/sigma/plugins/sigma.parsers.json.min.js"></script>
<script src="/static/sigma/plugins/sigma.pathfinding.astar.min.js"></script>
<script src="/static/sigma/plugins/sigma.plugins.animate.min.js"></script>
<script src="/static/sigma/plugins/sigma.plugins.dragNodes.min.js"></script>
<script src="/static/sigma/plugins/sigma.plugins.filter.min.js"></script>
<script src="/static/sigma/plugins/sigma.plugins.neighborhoods.min.js"></script>
<script src="/static/sigma/plugins/sigma.plugins.relativeSize.min.js"></script>
<script src="/static/sigma/plugins/sigma.renderers.customEdgeShapes.min.js"></script>
<script src="/static/sigma/plugins/sigma.renderers.customShapes.min.js"></script>
<script src="/static/sigma/plugins/sigma.renderers.edgeLabels.min.js"></script>
<script src="/static/sigma/plugins/sigma.renderers.parallelEdges.min.js"></script>
<script src="/static/sigma/plugins/sigma.renderers.snapshot.min.js"></script>
<script src="/static/sigma/plugins/sigma.statistics.HITS.min.js"></script>

<link rel="stylesheet" type="text/css" href="/static/ajaxload.css" media="screen" />


<style>
  #graph-class {
    position: relative;
    width: 95%;
    height: 70%;
  }
</style>
<div id="graph-class" class="col-md-12"></div>



<script type="application/javascript">
  //
  // Create new Sigma instance in graph-class div
  //
  g = {
    nodes: [],
    edges: []
  };

  s = new sigma({
    graph: g,
    container: 'graph-class',
    renderer: {
      container: document.getElementById('graph-class'),
      type: 'canvas'
    },
    settings: {
     minNodeSize: 8,
     maxNodeSize: 16,
     minEdgeSize: 0.1,
     maxEdgeSize: 2,
     enableEdgeHovering: true,
     edgeHoverSizeRatio:3
     //doubleClickEnabled: false,
     //edgeHoverExtremities: true
   }
 });



 //
 // Get Neo4j JSON and parse it
 //
 sigma.parsers.json(
    '/neo4jJson',
    s,
    function() {
        var i,
        nodes = s.graph.nodes();
        edges = s.graph.edges();
        len_nodes = nodes.length;
        len_edges = edges.length;

        for (i = 0; i < len_nodes; i++) {

            if(nodes[i].labels[0] == "Movie"){
              nodes[i].color = '#ffa31a';
            }
            else{
              nodes[i].color = '#e60000';
            }

            if(nodes[i].properties['name']){
              nodes[i].label = nodes[i].properties['name']
            }else{
              nodes[i].label = nodes[i].properties['title']
            }
            nodes[i].size = s.graph.degree(nodes[i].id);

        }

        for (i = 0; i < len_edges; i++) {
            edges[i].label = edges[i].type
            edges[i].size = 0.2
        }

        // Refresh the display:
        s.refresh();

        // ForceAtlas Layout
        //s.startForceAtlas2({gravity:100,scalingRatio:70,slowDown:1000000});
        //setTimeout(function(){s.stopForceAtlas2();},1000);
      }
 );



 //
 // Initialize the dragNodes plugin
 //
 var dragListener = sigma.plugins.dragNodes(s, s.renderers[0]);



 //
 // Get Transform table JSON
 //
 var transform_table;
 $.getJSON("transform_table", function(json){
     transform_table = json;
 });



 //
 // Write properties and actions on sidebar
 //
 s.bind('clickNode', function(e) {
   var nodeIdx = e.data.node.id;
   var nodes = s.graph.nodes();
   nodes.forEach(function(node){
     if (nodeIdx === node.id) {
       var properties = node.labels[0]+"<br>"
       for (var i in node.properties){
           properties+=i+": "+node.properties[i]+"<br>"
       }
       var type = node.labels[0];
       var actions = "";
       for (var row in transform_table[type]) {
         actions += '<button type="button" id="button-actions" class="btn btn-primary" data-toggle="modal">'+transform_table[type][row]+'</button>'
         actions += '<br><br>'
       }
       var output = properties+"<br><br><h3>Actions</h3>"+actions
       $("#side-description").html(output);
     }
   });
 });


  //
  //
  //
  ajax_function = function(uri, method, data) {
    var request = {
        url: uri,
        type: method,
        contentType: "application/json",
        accepts: "application/json",
        cache: false,
        dataType: 'json',
        data: JSON.stringify(data),
        beforeSend: function (xhr) {
            xhr.setRequestHeader("Authorization",
                "Basic " + btoa(self.username + ":" + self.password));
        },
        error: function(jqXHR) {
            console.log("ajax error " + jqXHR.status);
        }
    };
    return $.ajax(request);
  }

  $(document).on('click', '#button-actions', function() {
    ajax_function("action","GET").done(function(data) {
      var result = ""
      for (var i = 0; i < data.actions.length; i++) {
        result += data.actions[i];
      }
      console.log(result)
      $("#modal-actions-content").html(result);
      $('#modal-actions').modal('show')
    });

  });


  $body = $("body");
  $(document).on({
      ajaxStart: function() { $body.addClass("loading");    },
       ajaxStop: function() { $body.removeClass("loading"); }
  });






</script>

<div id="modal-actions" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
  <div class="modal-dialog modal-lg" role="document">
      <div id="modal-actions-content" class="modal-content">
      </div>
  </div>
</div>



<div class="ajaxload"></div>
